# SSO  - –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ï–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–°–ê) –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ 

## Swagger grpc –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:44044/sw/

## Swagger http –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:8000/swagger/index.html

## Grafana
http://localhost:3000/grafana/

## Prometheus
http://localhost:9090/targets/


## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è 

### API:
HTTP-handlers –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å frontend, –∞ gRPC –¥–ª—è –æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.
* gRPC: gRPC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Protobuf –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ
–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å JSON (–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –≤ HTTP), —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
—Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏.
* HTTP: HTTP, —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –ø—Ä–æ—Å—Ç—ã–º –∏ –ª–µ–≥–∫–∏–º –¥–ª—è
–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å frontend-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏.


### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤

–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ä–∞–∑—É –≤—ã–¥–∞–µ—Ç access –∏ refresh —Ç–æ–∫–µ–Ω—ã, –º–∏–Ω—É—è —ç—Ç–∞–ø –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞—á–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Å–µ—Ä–≤–∏—Å–æ–º –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Patroni –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Patroni –∫–ª–∞—Å—Ç–µ—Ä, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å—á–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

### 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –∫–æ–Ω–µ—á–Ω–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –≤ Patroni –∫–ª–∞—Å—Ç–µ—Ä–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –≤–µ–¥—É—â–∏–º —É–∑–ª–æ–º –∏ —Ä–µ–ø–ª–∏–∫–∞–º–∏. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ, –¥–∞–Ω–Ω—ã–µ –æ –Ω–æ–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### 4. –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 15 –º–∏–Ω—É—Ç, —á—Ç–æ, –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è, –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –Ω–∞ –≤—Å–µ —Ä–µ–ø–ª–∏–∫–∏.

### 5. –í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –µ–µ –≤–ª–∏—è–Ω–∏–µ

–í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ö, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —è–≤–ª–µ–Ω–∏–µ–º. –û–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π, —Ç–∞–∫ –∫–∞–∫ –∫ –º–æ–º–µ–Ω—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–æ–≤, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

### 6. –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–ø–ª–∏–∫

–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å —Ä–µ–ø–ª–∏–∫, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –≤–µ–¥—É—â–∏–π —É–∑–µ–ª. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

### 7. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –Ω–µ–≤–µ–ª–∏–∫–∞, –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –º–∞–ª–∞, —Ç–∞–∫ –∫–∞–∫ —Å–∏–ª—å–Ω–æ–µ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∏ –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Å–∏—Å—Ç–µ–º–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ.

### 8. –ö–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–∞–∑—É–º–Ω—ã–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ä–∏—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏, —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∏ —É–ª—É—á—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç.


## –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Kafka –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Apache Kafka –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —Å–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Kafka-—Ç–æ–ø–∏–∫.

–ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:

1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è: –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.
2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞: –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Kafka-—Ç–æ–ø–∏–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Ç.–µ. —Å–µ—Ä–≤–∏—Å –Ω–µ –∂–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka, —Å–µ—Ä–≤–∏—Å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å "inProgress", —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—è –æ —Ç–æ–º, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –±—ã–ª–∞ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞.
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Kafka: –û—Ç–¥–µ–ª—å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ (coroutine) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Kafka, –ø–æ–ª—É—á–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å–ø–µ—à–Ω–æ–π –∏–ª–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, –≥–æ—Ä—É—Ç–∏–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ "Success".

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. –°–µ—Ä–≤–∏—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–µ—Ä–≤–∏—Å –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka-—Ç–æ–ø–∏–∫.
2. –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —Ç–æ–ø–∏–∫. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
3. –°–µ—Ä–≤–∏—Å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —Ç–æ–ø–∏–∫. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞—á–∏—Å–ª—è–µ—Ç –µ–º—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã.

## –í—ã–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–º —á–µ—Ä–µ–∑ Kafka

–î–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö protobuf. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å 
json —è–≤–ª—è–µ—Ç—Å—è —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª-–≤–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –±–∞–π—Ç (—Å–º. –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞. –ê–≤—Ç–æ—Ä
–ú–∞—Ä—Ç–∏–Ω –ö–ª–µ–ø–ø–º–∞–Ω). 

–ë—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä Kafka —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º   Schema Registry.  Schema Registry - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å 
–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ö–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ Kafka. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:
* –£–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è, –∏–∑–º–µ–Ω—è—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ç.–¥. –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
* –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ: Schema Registry –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ Kafka, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º–µ.
* –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é: –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Schema Registry –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π —Å—Ö–µ–º—ã –¥–ª—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏—Å—å –¥–≤–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ go. [Kafka-go](https://github.com/segmentio/kafka-go) –∏ [–°onfluent-kafka-go](https://github.com/confluentinc/confluent-kafka-go).
Kafka-go –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Schema Registry https://github.com/segmentio/kafka-go/issues/728#issuecomment-909690992 –∏ https://github.com/segmentio/kafka-go/issues/728#issuecomment-2221492034. 
–ß—Ç–æ–±—ã –Ω–µ  —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Schema Registry –ø—Ä–∏–Ω—è—Ç–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –°onfluent-kafka-go.

–ö—Ä–∞—Ç–∫–æ:

* Schema Registry - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ö–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤ Kafka. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º:
    * –£–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º: –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è, –∏–∑–º–µ–Ω—è—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ç.–¥. –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
    * –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ: Schema Registry –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ Kafka, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º–µ.
    * –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é: –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Schema Registry –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π —Å—Ö–µ–º—ã –¥–ª—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

* Kafka-go - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Golang –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Kafka.

* –ü—Ä–æ–±–ª–µ–º–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Kafka-go –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Schema Registry. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Schema Registry –≤—Ä—É—á–Ω—É—é.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:

* –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –Ω–∞–π—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Golang, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç Schema Registry, —Ç–∞–∫–∏–µ –∫–∞–∫ `confluent-kafka-go` –∏–ª–∏ `go-avro` .
* –õ–∏–±–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Schema Registry.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ Schema Registry:
    * `confluent-kafka-go` - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç Confluent, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Schema Registry (https://github.com/confluentinc/confluent-kafka-go).
    * `go-avro` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Avro, –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Schema Registry (https://github.com/linkedin/goavro).
2. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç —Ä—É—á–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Schema Registry:
    * –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ö–µ–º—ã –∏–∑ Schema Registry –∏ –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
    * –ù–æ —ç—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏–π –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–æ Schema Registry.


################################################################################################## 

cd authloyalty/protos/proto/registration
protoc --go_out=. registration.proto

easyjson -all /home/alex/Dev/GolandYandex/authloyalty/internal/handlersapi/v1/sso_handlers_response.go


```bash
curl --header "Content-Type: application/json" --request POST --data '{"email":"test@test.com","password":"test"}' http://localhost:8000/auth/login
```

```bash
curl --header "Content-Type: application/json" --request POST --data '{"email":"test@test.com","password":"test"}' http://localhost:8000/auth/registration
```

```bash
curl --header "Content-Type: application/json" --request POST --data '{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InRlc3RAdGVzdC5jb20iLCJleHAiOjE3MjI0MzIwODMsInRva2VuX3R5cGUiOiJhY2Nlc3MiLCJ1aWQiOjJ9.J6XilG2yEAM611yybY8LdvXs046yrx8bjCoWlwd5dtQ"}' http://localhost:8000/auth/logout
```

// HOW TO ADD GRPC SWAGGER
https://apidog.com/articles/how-to-add-swagger-ui-for-grpc/

1. download buf bin from github
2. rename to buf
3. move to /usr/bin
4. chmod +x buf
5. buf generate 

if Failure: plugin openapiv2: could not find protoc plugin for name openapiv2 - please make sure protoc-gen-openapiv2 is installed and present on your $PATH
```bash
go install \
    github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-grpc-gateway \
    github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-openapiv2 \
    google.golang.org/protobuf/cmd/protoc-gen-go \
    google.golang.org/grpc/cmd/protoc-gen-go-grpc
```

# redis sentinel
https://redis.uptrace.dev/guide/go-redis-sentinel.html#redis-server-client

# auth swagger
http://localhost:8000/swagger/index.html

```
swag init -g ./cmd/sso/main.go -o ./cmd/sso/docs
```

if err when starts 

Golang swaggo rendering error: "Failed to load API definition" and "Fetch error doc.json" [closed]
Where the routers locate
n most cases, the problem is that you forgot to import the generated docs as _ "<your-project-package>/docs" 
in my case
_ "github.com/AlexBlackNn/authloyalty/cmd/sso/docs"


metrics
https://stackoverflow.com/a/65609042
https://github.com/prometheus/client_golang
https://grafana.com/oss/prometheus/exporters/go-exporter/#metrics-usage

// otel instrumentation
https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation#new-instrumentation
https://github.com/open-telemetry/opentelemetry-go-contrib/blob/main/instrumentation/github.com/gin-gonic/gin/otelgin/example/server.go
https://github.com/confluentinc/confluent-kafka-go/issues/712
https://github.com/etf1/opentelemetry-go-contrib

// kafka health check
https://github.com/confluentinc/confluent-kafka-go/discussions/1041

# using confluent-kafka-go
https://stackoverflow.com/a/55106860
CGO_ENABLED=0 can't be used, so dynamic links
https://github.com/confluentinc/confluent-kafka-go/issues/303?ysclid=lzrc7rstfd681525235#issuecomment-530566274
https://stackoverflow.com/a/69030479
https://github.com/confluentinc/confluent-kafka-go/issues/461

https://stackoverflow.com/questions/37630274/what-do-these-go-build-flags-mean-netgo-extldflags-lm-lstdc-static
https://blog.hashbangbash.com/2014/04/linking-golang-statically/ 



–†–µ—à–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–∞–º–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ. –ü–æ–ª—É—á–∏–≤—à–∏–π—Å—è –æ–±—Ä–∞–∑ —Å—Ç–∞–ª 68 –ú–ë, —á—Ç–æ —Ä–∞–¥—É–µ—Ç –ø—Ä–æ—Ç–∏–≤ 890–ú–ë –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ ü§Ø

RUN GOOS=linux go build -ldflags '-extldflags "-static"' -o main ./cmd/sso/main.go

Do not link against shared libraries. This is only meaningful on platforms for which shared libraries are supported. The different variants of this option are for compatibility with various systems. You may use this option multiple times on the command line: it affects library searching for -l options which follow it. This option also implies --unresolved-symbols=report-all. This option can be used with -shared. Doing so means that a shared library is being created but that all of the library's external references must be resolved by pulling in entries from static libraries.
https://github.com/ko-build/ko/issues/756#issue-1298084220

githubassets.com
Build with -extldflags="-static" by default ¬∑ Issue #756 ¬∑ ko-build/ko ¬∑ GitHub

-extldflags flags Set space-separated flags to pass to the external linker. from https://pkg.go.dev/cmd/link -static Do not link against shared libraries. This is only meaningful on platforms for which shared libraries are supported. The...

–í–æ—Ç –µ—â–µ –∫—Ä—É—Ç–æ–π —Ç—É—Ç–æ—Ä–∏–∞–ª –Ω–∞—à–µ–ª https://blog.hashbangbash.com/2014/04/linking-golang-statically/ –ò–∑ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ  ldd –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ—é—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∏–ª–∏ –Ω–µ—Ç –ª–∏–Ω–∫–æ–≤–∫–∞. –ò —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ " go build --ldflags '-extldflags "-static"' ./code-cgo.go"

https://stackoverflow.com/a/76177689 -  –∞ –≤ —ç—Ç–æ–π —Å—Å—ã–ª–∫–µ —É –º–µ–Ω—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –¥–æ–±–∞–≤–∫–∞ -tags musl

GOOS=linux go build -tags musl -o main ./cmd/sso/main.go

/snap/go/10660/pkg/tool/linux_amd64/link: running gcc failed: exit status 1
/usr/bin/ld: /home/alex/go/pkg/mod/github.com/confluentinc/confluent-kafka-go@v1.9.2/kafka/librdkafka_vendor/librdkafka_musl_linux.a(rdkafka_admin.o): in function `rd_kafka_CreateTopicsResponse_parse':
(.text+0x730): undefined reference to `strlcpy'
/usr/bin/ld: (.text+0x834): undefined reference to `strlcpy'
/usr/bin/ld: (.text+0xcef): undefined reference to `strlcpy'
/usr/bin/ld: (.text+0xe7d): undefined reference to `strlcpy'
/usr/bin/ld: (.text+0x1014): undefined reference to `strlcpy'